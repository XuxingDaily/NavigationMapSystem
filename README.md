# 小谷围岛导航地图系统

## 一、数据种类？如何获取？

- **各类POI**：通过高德API爬取；
- **公交站点和公交线路**：使用网络爬虫。首先从8684公交网站获取公交线路名称，再用爬取到的线路名称通过高德api进行批量爬取线要素，最后使用pandas对爬取到的公交线路数据进行处理，保存后导入数据库；
- **路网数据**：从OSM平台下载数据，并导入GIS平台软件。人工进行数据清洗，包括识别并处理拓扑错误，统一和标准化属性，道路打断处理，最终导入MySQL数据库。

## 二、系统设计

- **前端**：采用传统的HTML、CSS、JavaScript（Typescript）进行开发。GIS渲染使用自研的GIS可视化库支持矢量渲染，并使用webpack进行打包压缩；
- **后端**：使用node.js的Express库进行开发，并采用了类似MVC的模式，分离了数据管理、用户界面展示、和请求处理逻辑，使代码更模块化，便于理解和维护；
- **数据库**：使用MySQL数据库存储路网数据、POI数据和公交数据。

## 三、数据库如何设计？

- **自驾导航**：使用节点与边分离的图结构表示法，用三个表分别表示节点和边。自驾导航使用Dijkstra算法计算最短路径。
- **公交导航**：使用以边为记录的图结构表示法，一个表存储所有边的信息。公交导航使用BFS算法进行计算。

## 四、算法如何选择？

- **自驾导航**：使用Dijkstra算法计算最短路径，因为它适用于带有正权重的图。
- **公交导航**：使用BFS算法，以找到包括最少换乘次数的路径。

## 五、具体流程

1. 前端搜索框接收用户输入的起点和终点，发送请求至后端；
2. 后端使用POI名称获取坐标信息，并用最近邻搜索算法找到最接近的路网节点；
3. 后端通过路网节点计算最短路径，返回路径数据至前端；
4. 前端使用GIS可视化库渲染返回的路径数据。

## 六、难点

- **数据预处理**：导航系统需要处理和清洗复杂的路网数据。
- **算法实现**：需要根据不同导航类型选择并实现合适的算法。
- **系统搭建**：选择合适的技术栈，搭建前后端系统，并设计数据库。
- **性能优化**：确保导航系统运行效率和响应速度。

## 七、地图可视化模块

- **几何模块**：定义几何实体数据结构，如点、线、面。
- **要素模块**：对几何和属性数据的封装。
- **要素集模块**：管理要素集，包括元数据、数据类型和字段。
- **符号模块**：定义要素的视觉表示，如颜色、线宽。
- **渲染模块**：实现单一符号、分类和分段渲染。
- **要素图层模块**：结合要素集和渲染方式，形成图层。
- **瓦片地图模块**：独立地显示地图瓦片。
- **投影模块**：包括Web墨卡托投影和坐标转换。
- **包络矩形模块**：处理四至和相交检测。
- **注记模块**：管理地图文本标注，避免重叠。
- **地图模块**：地图的核心功能，包括地图初始化、视图设置、图层管理和交互功能。
